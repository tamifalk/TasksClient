<div class="task-card" [ngClass]="viewMode()" [attr.data-status]="task().status">
  <div class="card-inner">
    <div class="content-wrapper">

      <div class="project-tag" [title]="'Project: ' + projectName()">
        <mat-icon>folder</mat-icon>
        <span class="project-label">Project:</span>
        <span class="project-name">{{ projectName() }}</span>
      </div>

      <div class="task-title" [title]="task().title">{{ task().title }}</div>

      <select class="status-select" #statusSelect (change)="updateField(task().id,{status: statusSelect.value})"
        [style.backgroundColor]="getStatusColor(task().status)" [attr.data-status]="task().status || ''">
        @for(option of statuses; track option) {
        <option [value]="option" [selected]="option === task().status">{{ option }}</option>
        }
      </select>

      <select class="priority-select" #prioritySelect (change)="updateField(task().id,{priority: prioritySelect.value})"
        [attr.data-priority]="task().priority || ''">
        @for(option of priorities; track option) {
        <option [value]="option" [selected]="option === task().priority">{{ option }}</option>
        }
      </select>

      <div class="task-date">
        <mat-icon>calendar_today</mat-icon>
        <span>{{ task().due_date | date:'dd/MM/yyyy' }}</span>
      </div>

      <div class="actions">
        <button class="icon-btn" (click)="isComments.set(!isComments())">
          <mat-icon>chat_bubble_outline</mat-icon>
        </button>
        <button class="icon-btn delete" (click)="onDelete()">
          <mat-icon>delete_outline</mat-icon>
        </button>
      </div>

    </div>
  </div>

  @if (isComments()) {
  <div class="comments-section">
    <app-comments [taskId]="task().id" (commentClose)="isComments.set(false)">
    </app-comments>
  </div>
  }
</div>